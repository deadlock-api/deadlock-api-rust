DROP TABLE IF EXISTS mmr_history;

CREATE TABLE IF NOT EXISTS mmr_history
(
    account_id    UInt32,
    match_id      UInt64,
    hero_id       Nullable(UInt32) default NULL,
    player_score  Float64,
    rank          UInt32 ALIAS [
        0,
        11,
        12,
        13,
        14,
        15,
        16,
        21,
        22,
        23,
        24,
        25,
        26,
        31,
        32,
        33,
        34,
        35,
        36,
        41,
        42,
        43,
        44,
        45,
        46,
        51,
        52,
        53,
        54,
        55,
        56,
        61,
        62,
        63,
        64,
        65,
        66,
        71,
        72,
        73,
        74,
        75,
        76,
        81,
        82,
        83,
        84,
        85,
        86,
        91,
        92,
        93,
        94,
        95,
        96,
        101,
        102,
        103,
        104,
        105,
        106,
        111,
        112,
        113,
        114,
        115,
        116
        ][toUInt8(clamp(player_score, 0, 66) + 1)],
    division      UInt32 ALIAS rank / 10,
    division_tier UInt32 ALIAS rank % 10
) ENGINE = ReplacingMergeTree
      PARTITION BY (hero_id)
      ORDER BY (hero_id, account_id, match_id)
      SETTINGS allow_nullable_key = 1;

INSERT INTO default.mmr_history (account_id, match_id, hero_id, player_score)
VALUES (312461313, 32705333, null, 42.807547919054144),
       (85098186, 35974917, null, 9.194165211578989),
       (320459486, 33185477, null, 16.618507618765857),
       (336254882, 30739742, null, 15.576216732599066),
       (5860501, 36379009, null, 26.04726558594174),
       (5557154, 36564797, null, 22.63919258701047),
       (84161969, 31269682, null, 44.38594556125321),
       (896962711, 31104198, null, 58.86311665978708),
       (331699044, 36584085, null, 27.84717481355032),
       (133362252, 31169419, null, 14.273624760963253),
       (917234850, 34269250, null, 33.01819249975513),
       (206836522, 31185194, null, 17.350505835385338),
       (124403042, 33677050, null, 27.8887382237571),
       (429764805, 33460552, null, 9.7675812611914),
       (148760999, 31445241, null, 41.71355024451238),
       (1279134306, 30986241, null, 37.89146808008973),
       (1839845954, 31418338, null, 41.30402174844918),
       (130143242, 34253981, null, 32.66112016266266),
       (23328779, 33135827, null, 25.29918660291086),
       (185761386, 36250708, null, 16.12190081980561),
       (340164809, 31498821, null, 10.286829735235528),
       (1846587001, 33696027, null, 43.15518784032907),
       (115300039, 32161381, null, 15.87371309947407),
       (450199769, 32061074, null, 28.84380063585191),
       (852952061, 34358769, null, 19.782128588901312),
       (430871434, 32580047, null, 31.682162204769234),
       (18552818, 35474627, null, 39.35086742982492),
       (1088598208, 36396491, null, 18.327298326217836),
       (275075544, 31322362, null, 17.259412746686973),
       (24947831, 35558770, null, 65.88147846751986),
       (160914389, 35930596, null, 38.431044089355474),
       (248501844, 32620353, null, 24.80161104308874),
       (321159903, 35031452, null, 45.99508308447279),
       (1455402280, 31317294, null, 13.621509795193436),
       (106241043, 32677328, null, 23.195070720899917),
       (1011872819, 34110356, null, 13.05961594054121),
       (235045159, 32139893, null, 19.711766128207085),
       (329335823, 31122437, null, 38.82431436910588),
       (104200432, 30862941, null, 26.770842273377937),
       (887256537, 36348436, null, 41.31970180717137),
       (1032360778, 35602713, null, 16.828771595291325),
       (1561399996, 32327412, null, 49.18025178340492),
       (129552190, 36184270, null, 14.133867527415916),
       (101522619, 36357034, null, 35.180821230814345),
       (1115583696, 34735457, null, 12.175249839537699),
       (872340163, 33459958, null, 38.57420259650437),
       (1536806067, 32412885, null, 45.28539294677319),
       (322479852, 35011031, null, 19.23652463213575),
       (304840492, 31355095, null, 37.339452415345384),
       (94905762, 32906729, null, 16.20867806472944),
       (895417629, 34815707, null, 48.10923277114993),
       (83880513, 35066266, null, 13.908038489907899),
       (205333743, 33023364, null, 39.84986815891825),
       (158292090, 34866418, null, 19.901158916274497),
       (313458997, 31875511, null, 22.945082880904373),
       (1682261654, 34134632, null, 36.022203376251476),
       (1052345567, 33546784, null, 21.307797021785),
       (114163593, 30826213, null, 36.600916597333544),
       (260063577, 35114383, null, 55.42597211895319),
       (449464912, 32234773, null, 25.81808399349582),
       (100735524, 34646129, null, 25.629419112831062),
       (966809943, 33786893, null, 29.77094365631633),
       (4309159, 32568450, null, 37.76415189954329),
       (1282662759, 32923834, null, 10.535342896775541),
       (66640457, 35913351, null, 40.52283008966707),
       (228539319, 36537307, null, 28.31484701696169),
       (1271293898, 34083684, null, 33.9341248764735),
       (409663457, 33409395, null, 19.876867525235827),
       (405372765, 32481529, null, 12.657654769145907),
       (164505506, 34302050, null, 14.635412392726558),
       (1587228069, 34725229, null, 36.094494035592234),
       (1016563542, 36588978, null, 35.27986657479601),
       (34952514, 36163502, null, 43.13286440811719),
       (52147487, 34437977, null, 20.977246719195833),
       (348003365, 34511686, null, 36.43764513100834),
       (13089378, 33350254, null, 17.712594418046674),
       (166846995, 33500885, null, 34.84931174225182),
       (183538357, 32778833, null, 28.19774831565299),
       (387863295, 36362886, null, 17.53405648191746),
       (109191104, 35597382, null, 22.455668196315493),
       (908249811, 34340590, null, 31.585199768541568),
       (150874895, 34360699, null, 26.258333578776227),
       (1152974896, 34189497, null, 17.362639753520778),
       (58863950, 31846733, null, 35.40232081727311),
       (986672099, 28679476, null, 34.99897019743326),
       (344477317, 35514827, null, 55.89839369325565),
       (356551760, 31043526, null, 41.77513967817971),
       (1231136117, 33463560, null, 13.93034641565715),
       (969975089, 35264991, null, 51.84854690618042),
       (1731656072, 32360630, null, 30.45573125765835),
       (278923832, 32516235, null, 39.32985061678273),
       (266592908, 33815298, null, 38.10327880246407),
       (1609064896, 31439849, null, 23.504096860660315),
       (164687348, 34259310, null, 31.707834246758566),
       (1052118405, 32556458, null, 41.94171816350407),
       (907650290, 30756096, null, 47.57294598775841),
       (1051659405, 35507293, null, 16.691536459595426),
       (210076865, 28700840, null, 40.18383752953798),
       (106220290, 32852752, null, 28.772104603109337),
       (164294544, 33256921, null, 22.672112668902255),
       (89141231, 34158067, null, 17.02775481634301),
       (1064333658, 32223385, null, 24.775857263731666),
       (888327418, 31747842, null, 55.700024270371905),
       (873632962, 36537796, null, 58.91766310539849),
       (86899141, 31674809, null, 20.756226991522915),
       (104312841, 32313640, null, 34.00228288046049),
       (225024210, 35861233, null, 21.301417778264444),
       (106243347, 31033716, null, 25.377566734099123),
       (71160, 34573906, null, 41.261955333386794),
       (65581136, 33676320, null, 22.741325193975733),
       (247185980, 30704088, null, 42.51008838749357),
       (189192807, 35423751, null, 20.149025320776378),
       (301594065, 33462293, null, 67.84959799141566),
       (144468731, 33035567, null, 38.321550944175755),
       (1005820169, 35965958, null, 28.225895094449918),
       (1837224457, 30845914, null, 20.521917827268414),
       (1162049747, 35075689, null, 42.009794674578934),
       (123344427, 32585659, null, 36.06113994745219),
       (927203400, 33680875, null, 44.753531279741495),
       (159254121, 32967397, null, 31.057806115952815),
       (320315270, 31563505, null, 26.421537092642893),
       (1406855967, 33731512, null, 39.3132903253642),
       (1102412728, 35508718, null, 26.557313634909033),
       (143417824, 34204466, null, 24.737488941703255),
       (1071540477, 32094728, null, 47.73427568954407),
       (88308580, 35704652, null, 47.28944857942501),
       (1234686751, 33302852, null, 28.23236828130224),
       (120853284, 33542637, null, 42.5677185779592),
       (174662446, 31048118, null, 50.01003624328771),
       (472701822, 34952839, null, 30.826538527716345),
       (204149048, 36181248, null, 12.616062815364929),
       (61720720, 34702476, null, 16.87806542011398),
       (1800711756, 34229985, null, 10.727320289872742),
       (11282001, 30908728, null, 40.51212267004563),
       (895442618, 33328520, null, 13.681858243410323),
       (78998650, 36607396, null, 37.02762902827419),
       (119541614, 34995448, null, 42.98020054156058),
       (20863531, 32402273, null, 19.73170122628499),
       (5863, 32736055, null, 15.849238545606436),
       (1080299816, 33751722, null, 27.743289309103183),
       (1133248051, 31576885, null, 42.95460136417454),
       (1023529103, 36205291, null, 24.23909904088999),
       (93593448, 35479143, null, 40.036255609858664),
       (1287184521, 32521549, null, 17.336574556792602),
       (1546876189, 34784963, null, 39.718655224688824),
       (105986542, 31125529, null, 40.423289644883205),
       (905143564, 32280234, null, 18.288140193481368),
       (154893004, 31464708, null, 41.733582529783455),
       (1053443591, 33489351, null, 26.80994883609434),
       (57384719, 31586117, null, 42.86903544008824),
       (21849028, 34693908, null, 33.70480480270883),
       (1209828201, 34894809, null, 36.422869729308644),
       (3084315, 36449839, null, 33.3274221700082),
       (195700756, 31584573, null, 37.65954661955979),
       (896776657, 36132765, null, 20.2430157671068),
       (904672695, 36085380, null, 7.995996960592935),
       (1247990232, 32505306, null, 24.990621470608776),
       (1111221230, 36037759, null, 45.949170531118355),
       (186482612, 31289485, null, 37.18446365606541),
       (345696422, 33920085, null, 26.310000510378618),
       (410412400, 32165594, null, 23.766182904757446),
       (483003058, 32872096, null, 34.05465484703918),
       (1087631765, 35685520, null, 30.55973431330566),
       (111837866, 32145387, null, 29.665047401217386),
       (1154209761, 31300126, null, 22.293038955109743),
       (1048624868, 33085401, null, 37.81158328342504),
       (76320674, 32780193, null, 35.42991096590478),
       (842797416, 31441600, null, 38.90411122474109),
       (152251838, 30774810, null, 30.08358921621523),
       (381715489, 31097641, null, 38.697829285555926),
       (999696120, 32840106, null, 38.25007595999852),
       (246485541, 35823343, null, 39.3413009586009),
       (80814536, 34571675, null, 37.940199161497134),
       (131227196, 32106753, null, 29.853108184037044),
       (294132126, 33712442, null, 34.440533232517694),
       (437358850, 35934554, null, 44.90595318345948),
       (1431270025, 34775041, null, 34.568130845408525),
       (889986369, 31413755, null, 33.797897775724),
       (209529570, 34299591, null, 12.191223795336128),
       (161045470, 32861335, null, 32.431124470491426),
       (86374096, 32530278, null, 29.938312598599396),
       (82248685, 32259461, null, 15.050677469306743),
       (921339112, 36532030, null, 39.18689125170562),
       (43862672, 34412393, null, 7.161436070272644),
       (195290794, 30954285, null, 29.251088821436024),
       (67778762, 36168113, null, 30.0036242859019),
       (471398070, 35003364, null, 31.475716159344273),
       (1077946095, 35102277, null, 34.06403430139361),
       (1151931619, 35453241, null, 16.751740218376412),
       (239182278, 33374933, null, 46.46316299775993),
       (113409250, 31790717, null, 25.21490138465198),
       (142859387, 34213645, null, 41.463066622884455),
       (168138541, 31713721, null, 15.733604258015191),
       (1095172945, 33864815, null, 52.70537107404763),
       (293068427, 32266782, null, 34.26645991065216),
       (291755462, 33831200, null, 53.92988819300521),
       (1616469758, 31238958, null, 33.95857121305568),
       (1419601951, 30821442, null, 36.57130945869289),
       (1441050499, 34781442, null, 31.7743432837298),
       (384182449, 32016508, null, 26.33393758771288),
       (18373975, 28684967, null, 48.36564037698817),
       (18373975, 28688991, null, 48.22102728953173);
