create table default.mmr_history
(
    algorithm     Enum8('LinearRegression' = 0) default 'LinearRegression',
    account_id    UInt32,
    match_id      UInt64,
    player_score  Float32,
    rank          UInt32 alias [0, 11, 12, 13, 14, 15, 16, 21, 22, 23, 24, 25, 26, 31, 32, 33, 34, 35, 36, 41, 42, 43, 44, 45, 46, 51, 52, 53, 54, 55, 56, 61, 62, 63, 64, 65, 66, 71, 72, 73, 74, 75, 76, 81, 82, 83, 84, 85, 86, 91, 92, 93, 94, 95, 96, 101, 102, 103, 104, 105, 106, 111, 112, 113, 114, 115, 116][toUInt8(clamp(player_score, 0, 66) + 1)],
    division      UInt32 alias rank / 10,
    division_tier UInt32 alias rank % 10
)
    engine = ReplacingMergeTree PARTITION BY algorithm
        ORDER BY (algorithm, account_id, match_id)
        SETTINGS index_granularity = 8192;

INSERT INTO default.mmr_history (algorithm, account_id, match_id, player_score)
VALUES ('LinearRegression', 18373975, 28684967, 48.36564),
       ('LinearRegression', 18373975, 28688991, 48.221024),
       ('LinearRegression', 18373975, 28924306, 48.31329),
       ('LinearRegression', 18373975, 28928103, 48.31968),
       ('LinearRegression', 18373975, 29027469, 48.486023),
       ('LinearRegression', 18373975, 29029367, 48.62107),
       ('LinearRegression', 18373975, 29561860, 48.58639),
       ('LinearRegression', 65, 28868447, 16.882835),
       ('LinearRegression', 65, 28870134, 16.63857),
       ('LinearRegression', 65, 28996626, 16.549925),
       ('LinearRegression', 65, 28998509, 16.207747),
       ('LinearRegression', 65, 28999551, 16.033417),
       ('LinearRegression', 65, 30186391, 15.57809),
       ('LinearRegression', 385, 28644168, 14.6015),
       ('LinearRegression', 385, 28652262, 14.326399),
       ('LinearRegression', 385, 28750550, 13.394331),
       ('LinearRegression', 385, 28766535, 13.167808),
       ('LinearRegression', 385, 28843857, 13.096304),
       ('LinearRegression', 385, 28848162, 13.058089),
       ('LinearRegression', 385, 28851481, 12.986815),
       ('LinearRegression', 385, 28852738, 12.957571),
       ('LinearRegression', 385, 28855083, 13.083227),
       ('LinearRegression', 385, 28866754, 12.959261),
       ('LinearRegression', 385, 29268388, 12.447424),
       ('LinearRegression', 385, 29345723, 12.160257),
       ('LinearRegression', 385, 29347126, 11.440578),
       ('LinearRegression', 385, 29348834, 11.285263),
       ('LinearRegression', 385, 29421402, 11.295795),
       ('LinearRegression', 385, 29498032, 11.0079155),
       ('LinearRegression', 385, 29501370, 11.3290205),
       ('LinearRegression', 385, 29509807, 11.516199),
       ('LinearRegression', 385, 29512123, 11.036645),
       ('LinearRegression', 385, 29514646, 11.172463),
       ('LinearRegression', 385, 29520233, 11.50923),
       ('LinearRegression', 385, 29527989, 11.158801),
       ('LinearRegression', 385, 29530782, 10.833826),
       ('LinearRegression', 385, 29532252, 10.530878),
       ('LinearRegression', 385, 29534497, 10.366254),
       ('LinearRegression', 385, 29603717, 10.62405),
       ('LinearRegression', 385, 29606116, 10.269214),
       ('LinearRegression', 385, 29608714, 10.048029),
       ('LinearRegression', 385, 29610001, 10.4157715),
       ('LinearRegression', 385, 29612760, 10.01131),
       ('LinearRegression', 385, 29614569, 10.2774),
       ('LinearRegression', 385, 29617459, 10.227854),
       ('LinearRegression', 385, 29624619, 10.111284),
       ('LinearRegression', 385, 29625510, 9.80715),
       ('LinearRegression', 385, 29626947, 10.025914),
       ('LinearRegression', 385, 31915954, 10.325163),
       ('LinearRegression', 449, 30367182, 14.815536),
       ('LinearRegression', 798, 28721276, 33.880074),
       ('LinearRegression', 798, 28831394, 33.390793),
       ('LinearRegression', 798, 29815760, 33.066517),
       ('LinearRegression', 798, 29954372, 33.347603),
       ('LinearRegression', 798, 29957959, 33.036304),
       ('LinearRegression', 798, 30444625, 32.806843),
       ('LinearRegression', 798, 30947165, 32.458458),
       ('LinearRegression', 798, 31320520, 32.114677),
       ('LinearRegression', 1603, 30181880, 17.11137),
       ('LinearRegression', 1603, 34404307, 17.591307),
       ('LinearRegression', 1978, 30639499, 16.342697),
       ('LinearRegression', 1978, 30844580, 16.004576),
       ('LinearRegression', 2038, 31080215, 20.562431),
       ('LinearRegression', 2038, 31212999, 20.642992),
       ('LinearRegression', 2038, 31214268, 20.779299),
       ('LinearRegression', 2219, 28741542, 18.332008),
       ('LinearRegression', 2219, 28744625, 18.355204),
       ('LinearRegression', 2219, 28746286, 18.51123),
       ('LinearRegression', 2219, 28751216, 18.578426),
       ('LinearRegression', 2219, 28755520, 18.6574),
       ('LinearRegression', 2219, 28758066, 18.884968),
       ('LinearRegression', 2219, 29162875, 18.99926),
       ('LinearRegression', 2219, 29166317, 19.040274),
       ('LinearRegression', 2219, 29168697, 19.058603),
       ('LinearRegression', 2219, 29170218, 19.447588),
       ('LinearRegression', 2219, 29228794, 19.692934),
       ('LinearRegression', 2219, 29252204, 19.798672),
       ('LinearRegression', 2219, 29257065, 19.640934),
       ('LinearRegression', 2219, 29259651, 19.316038),
       ('LinearRegression', 2219, 29294554, 19.06644),
       ('LinearRegression', 2219, 29297335, 18.826475),
       ('LinearRegression', 2219, 29316722, 18.977076),
       ('LinearRegression', 2219, 29336531, 19.15158),
       ('LinearRegression', 2219, 29338396, 19.091095),
       ('LinearRegression', 2219, 29340565, 19.044693),
       ('LinearRegression', 2219, 29378588, 19.33172),
       ('LinearRegression', 2219, 29388632, 19.6549),
       ('LinearRegression', 2219, 29396665, 19.510918),
       ('LinearRegression', 2219, 29401634, 19.749903),
       ('LinearRegression', 2219, 29414279, 20.013922),
       ('LinearRegression', 2219, 29416033, 20.107903),
       ('LinearRegression', 2219, 29419843, 20.233137),
       ('LinearRegression', 2219, 29423798, 19.961351),
       ('LinearRegression', 2219, 29474419, 20.281088),
       ('LinearRegression', 2219, 29488492, 19.961004),
       ('LinearRegression', 2219, 29497005, 19.886274),
       ('LinearRegression', 2219, 29501662, 19.49057),
       ('LinearRegression', 2219, 29505431, 19.523277),
       ('LinearRegression', 2219, 29517794, 19.276903),
       ('LinearRegression', 2219, 29520635, 19.258268),
       ('LinearRegression', 2219, 29524223, 19.544022),
       ('LinearRegression', 2219, 29525524, 19.70684),
       ('LinearRegression', 2219, 29527774, 19.43002),
       ('LinearRegression', 2219, 29563671, 19.322802),
       ('LinearRegression', 2219, 29588866, 19.210934),
       ('LinearRegression', 2219, 29597529, 18.978786),
       ('LinearRegression', 2219, 29599806, 19.345308);
