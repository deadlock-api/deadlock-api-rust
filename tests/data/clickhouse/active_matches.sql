DROP TABLE IF EXISTS active_matches;

create table active_matches
(
    start_time                     DateTime,
    winning_team                   UInt8,
    match_id                       UInt64,
    `players.account_id`           Array(UInt64),
    `players.team`                 Array(UInt8),
    `players.abandoned`            Array(Bool),
    `players.hero_id`              Array(UInt8),
    lobby_id                       String,
    net_worth_team_0               UInt32,
    net_worth_team_1               UInt32,
    duration_s                     UInt32,
    spectators                     UInt16,
    open_spectator_slots           UInt16,
    objectives_mask_team0          UInt16,
    objectives_mask_team1          UInt16,
    match_mode                     Enum8('Invalid' = 0, 'Unranked' = 1, 'PrivateLobby' = 2, 'CoopBot' = 3, 'Ranked' = 4, 'ServerTest' = 5, 'Tutorial' = 6, 'HeroLabs' = 7),
    game_mode                      Enum8('Invalid' = 0, 'Normal' = 1, 'OneVsOneTest' = 2, 'Sandbox' = 3),
    match_score                    UInt16,
    region_mode                    Enum8('Row' = 0, 'Europe' = 1, 'SEAsia' = 2, 'SAmerica' = 3, 'Russia' = 4, 'Oceania' = 5),
    scraped_at                     DateTime64(3) default now(),
    team0_core                     Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 0)) != 0,
    team0_tier1_lane1              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 1)) != 0,
    team0_tier2_lane1              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 2)) != 0,
    team0_tier1_lane2              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 3)) != 0,
    team0_tier2_lane2              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 4)) != 0,
    team0_tier1_lane3              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 5)) != 0,
    team0_tier2_lane3              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 6)) != 0,
    team0_tier1_lane4              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 7)) != 0,
    team0_tier2_lane4              Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(1, 8)) != 0,
    team0_titan                    Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(toUInt16(1), 9)) != 0,
    team0_titan_shield_generator_1 Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(toUInt16(1), 10)) != 0,
    team0_titan_shield_generator_2 Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(toUInt16(1), 11)) != 0,
    team0_barrack_boss_lane1       Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(toUInt16(1), 12)) != 0,
    team0_barrack_boss_lane2       Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(toUInt16(1), 13)) != 0,
    team0_barrack_boss_lane3       Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(toUInt16(1), 14)) != 0,
    team0_barrack_boss_lane4       Bool alias bitAnd(objectives_mask_team0, bitShiftLeft(toUInt16(1), 15)) != 0,
    team1_core                     Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 0)) != 0,
    team1_tier1_lane1              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 1)) != 0,
    team1_tier2_lane1              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 2)) != 0,
    team1_tier1_lane2              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 3)) != 0,
    team1_tier2_lane2              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 4)) != 0,
    team1_tier1_lane3              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 5)) != 0,
    team1_tier2_lane3              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 6)) != 0,
    team1_tier1_lane4              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 7)) != 0,
    team1_tier2_lane4              Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 8)) != 0,
    team1_titan                    Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 9)) != 0,
    team1_titan_shield_generator_1 Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 10)) != 0,
    team1_titan_shield_generator_2 Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 11)) != 0,
    team1_barrack_boss_lane1       Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 12)) != 0,
    team1_barrack_boss_lane2       Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 13)) != 0,
    team1_barrack_boss_lane3       Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 14)) != 0,
    team1_barrack_boss_lane4       Bool alias bitAnd(objectives_mask_team1, bitShiftLeft(toUInt16(1), 15)) != 0,
    compat_version                 Nullable(UInt32),
    ranked_badge_level             Nullable(UInt32),
    game_mode_version              Nullable(Int32)
) engine = MergeTree PRIMARY KEY match_id
      ORDER BY match_id
      SETTINGS index_granularity = 8192;

INSERT INTO active_matches (start_time, winning_team, match_id, `players.account_id`, `players.team`,
                            `players.abandoned`, `players.hero_id`, lobby_id, net_worth_team_0,
                            net_worth_team_1, duration_s, spectators, open_spectator_slots,
                            objectives_mask_team0, objectives_mask_team1, match_mode, game_mode, match_score,
                            region_mode, scraped_at, compat_version, ranked_badge_level, game_mode_version)
VALUES ('2024-09-20 22:26:55', 0, 15180736,
        [19778795, 68204199, 87499190, 105867080, 139083841, 162139192, 191141277, 289808894, 327071094, 343752609,
            349600928, 482543686],
        [0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [8, 15, 11, 18, 12, 2, 13, 6, 7, 25, 1, 17], '173087107001142175', 52040, 53598, 0, 0, 10, 65529, 65505,
        'Unranked', 'Normal', 91, 'Row', '2024-09-24 17:25:06.000', null, null, null),
       ('2025-01-27 04:57:51', 0, 32317735,
        [296637832, 112958304, 188224154, 1026165347, 1100515615, 1325804100, 227009839, 35556692, 82540836,
            188376542, 67296213, 32625159],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [27, 10, 16, 13, 14, 25, 31, 3, 15, 1, 6, 2], '101213454467140092', 21516, 21384, 0, 0, 10, 65535, 65533,
        'Unranked', 'Normal', 1345, 'Oceania', '2025-01-27 05:03:57.000', 5475, null, null),
       ('2024-10-23 01:08:13', 0, 24286097,
        [934483015, 67389215, 59078543, 113791607, 839031293, 1263117850, 1607506829, 122379167, 225142954,
            861378631, 364226336, 851083720],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [1, 10, 25, 11, 31, 7, 17, 8, 15, 2, 6, 35], '173133647518388195', 79307, 90233, 0, 0, 10, 65313, 65217,
        'Unranked', 'Normal', 745, 'Row', '2024-10-23 01:28:15.000', null, null, null),
       ('2024-10-16 08:02:36', 0, 22927140,
        [839642425, 370691244, 1011392676, 444098559, 1180713669, 1151557141, 1258516544, 1130367688, 1404495096,
            1362210496, 1825908472, 1619639276],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [17, 50, 12, 19, 25, 2, 7, 20, 15, 27, 1, 13], '101066048941379248', 55974, 67676, 0, 0, 10, 65249, 65457,
        'Unranked', 'Normal', 889, 'SEAsia', '2024-10-16 08:17:27.000', null, null, null),
       ('2024-09-21 04:27:26', 0, 15276293,
        [87109722, 113889107, 120478767, 148803014, 162296881, 162591698, 170971589, 356489836, 388777681, 947327289,
            1112236978, 1181127176],
        [0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [13, 11, 17, 3, 1, 10, 19, 12, 27, 7, 2, 15], '173087584145130283', 0, 0, 0, 0, 10, 65535, 65535, 'Unranked',
        'Normal', 114, 'SAmerica', '2024-09-24 17:25:06.000', null, null, null),
       ('2024-10-21 07:07:51', 0, 23966858,
        [437614562, 1700869791, 1079359197, 143257885, 91376744, 888691213, 61285956, 898078101, 487383245,
            1121847988, 493543826, 196028748],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [2, 13, 17, 20, 10, 7, 19, 25, 31, 8, 6, 18], '173131073725679781', 146929, 177408, 0, 0, 10, 65089, 65505,
        'Unranked', 'Normal', 1807, 'SEAsia', '2024-10-21 07:35:18.000', null, null, null),
       ('2025-03-30 00:40:17', 0, 34408252,
        [291902996, 192227354, 1026623901, 1858642337, 889930078, 906444516, 131242710, 49971767, 50794527, 33029924,
            35692789, 969674969],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [52, 15, 13, 60, 1, 25, 31, 4, 17, 35, 50, 2], '173356877353159813', 99289, 106594, 0, 0, 10, 65509, 65509,
        'Unranked', 'Normal', 12005, 'Row', '2025-03-30 01:00:03.000', 5520, null, 2),
       ('2024-09-28 06:15:34', 0, 18042985,
        [353289433, 1034853885, 1059747399, 146162297, 165699820, 173369732, 1032702896, 1102890508, 139724909,
            247359792, 127682061, 176966446],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [52, 19, 4, 13, 31, 35, 27, 3, 1, 17, 7, 6], '101038497615794390', 131500, 107925, 0, 0, 10, 65505, 65281,
        'Unranked', 'Normal', 137, 'SEAsia', '2024-09-28 06:40:20.000', null, null, null),
       ('2024-10-03 07:08:44', 0, 19705670,
        [383091950, 999311822, 442801597, 174422194, 110002481, 73768569, 133192692, 393138638, 332433512, 884534555,
            884674393, 135999709],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [15, 52, 35, 7, 1, 13, 20, 50, 31, 17, 8, 2], '173104785992515029', 149966, 159057, 0, 0, 10, 6657, 60993,
        'Unranked', 'Normal', 110, 'SEAsia', '2024-10-03 07:36:25.000', null, null, null),
       ('2024-09-24 11:24:04', 0, 16668949,
        [10225866, 27146288, 65345388, 83734669, 100318989, 122468586, 127301613, 168980943, 491537358, 839001827,
            1414222357, 1808014816],
        [0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [4, 13, 10, 15, 3, 11, 6, 7, 19, 2, 1, 50], '101033993184654640', 187762, 184969, 0, 0, 10, 1, 65089,
        'Unranked', 'Normal', 197, 'Row', '2024-09-24 17:25:06.000', null, null, null),
       ('2024-10-04 03:28:54', 0, 19942694,
        [366402598, 61070182, 64744819, 180774470, 30426639, 64112266, 215223819, 1215057013, 1163626623, 183786377,
            66221521, 381409251],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [8, 19, 31, 7, 10, 1, 35, 6, 15, 13, 18, 11], '173106220595447195', 220408, 217006, 0, 1, 10, 22017, 513,
        'Unranked', 'Normal', 57, 'Row', '2024-10-04 04:03:55.000', null, null, null),
       ('2024-10-24 06:37:24', 0, 24497140,
        [455439382, 1430504951, 106540541, 181125705, 135792681, 162020648, 389408663, 85737684, 138420624,
            284131334, 151670687, 159860578],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [13, 1, 3, 15, 11, 10, 4, 27, 19, 50, 20, 7], '101077630572340378', 64373, 78681, 0, 0, 10, 65249, 65533,
        'Unranked', 'Normal', 1532, 'SEAsia', '2024-10-24 06:55:21.000', null, null, null),
       ('2024-10-05 21:35:02', 0, 20454162,
        [108771108, 160135109, 252905624, 864097670, 1112931779, 136763894, 1162386282, 1630869076, 384987280,
            418630762, 1018354520, 879689392],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [4, 52, 15, 17, 12, 3, 1, 13, 7, 10, 35, 2], '101050147563383340', 178473, 171443, 0, 0, 10, 1, 1,
        'Unranked',
        'Normal', 51, 'Row', '2024-10-05 22:09:14.000', null, null, null),
       ('2024-09-30 00:09:39', 0, 18750436,
        [52532861, 74670869, 110954232, 312953757, 192429012, 143556704, 1787087418, 914060580, 85665189, 84152258,
            320471786, 150812417],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [13, 4, 10, 3, 15, 17, 2, 12, 1, 7, 6, 19], '101042556997014936', 49437, 43764, 0, 0, 10, 65521, 65255,
        'Unranked', 'Normal', 79, 'Row', '2024-09-30 00:21:27.000', null, null, null),
       ('2024-10-14 07:16:25', 0, 22509723,
        [1100869908, 1018574243, 1421020034, 910788700, 319344211, 142122206, 964263423, 121260751, 227025910,
            203412982, 106553119, 32401955],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [7, 52, 19, 10, 2, 3, 15, 13, 8, 17, 12, 20], '173120640293862153', 40143, 38643, 0, 0, 10, 65519, 65535,
        'Unranked', 'Normal', 1166, 'Russia', '2024-10-14 07:28:20.000', null, null, null),
       ('2024-10-06 11:03:45', 0, 20595946,
        [1014466820, 92125485, 114096606, 930483681, 409517790, 407618866, 140417463, 253486575, 1163520186,
            1244388137, 1218667144, 94052208],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [25, 1, 10, 17, 7, 52, 8, 4, 2, 3, 15, 13], '173107741601429961', 95131, 77160, 0, 0, 10, 65473, 48897,
        'Unranked', 'Normal', 101, 'Russia', '2024-10-06 11:21:25.000', null, null, null),
       ('2024-09-21 11:09:20', 0, 15396299,
        [78026950, 83736201, 94254056, 94468489, 97695324, 103627780, 111695241, 113063840, 164867900, 277431184,
            884744417, 1012491707],
        [1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [18, 17, 27, 1, 4, 15, 2, 8, 13, 3, 10, 50], '101030227857180406', 78652, 88715, 0, 0, 10, 6657, 65457,
        'Unranked', 'Normal', 62, 'Oceania', '2024-09-24 17:25:06.000', null, null, null),
       ('2024-10-22 03:12:37', 0, 24123768,
        [238460553, 122855345, 320899180, 404818012, 105060266, 79305769, 119035447, 89520549, 30800460, 214386574,
            290474232, 1161271073],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [7, 3, 25, 15, 11, 2, 50, 13, 8, 1, 6, 31], '173132179562337119', 215760, 158125, 0, 0, 10, 65089, 1,
        'Unranked', 'Normal', 1321, 'Oceania', '2024-10-22 03:44:04.000', null, null, null),
       ('2024-10-13 14:00:12', 0, 22327694,
        [357657814, 125696715, 116040300, 123533005, 165238776, 43655561, 911859217, 60983647, 1114212153,
            1456600579, 912144317, 418893476],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [18, 1, 27, 17, 15, 31, 2, 3, 13, 6, 7, 52], '173119237047590221', 42923, 46641, 0, 0, 10, 65523, 65533,
        'Unranked', 'Normal', 1592, 'Europe', '2024-10-13 14:13:05.000', null, null, null),
       ('2025-01-16 10:29:48', 0, 31860403,
        [908974893, 83773938, 29801799, 998186633, 1133807056, 1038512981, 1119158090, 1007782716, 171705420,
            1811279869, 57438032, 31434895],
        [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
        [ false, false, false, false, false, false, false, false, false, false, false, false ],
        [1, 3, 4, 18, 19, 52, 2, 27, 15, 13, 6, 50], '101197873869274446', 136310, 129711, 0, 0, 10, 65161, 48641,
        'Unranked', 'Normal', 1853, 'Row', '2025-01-16 10:52:56.000', 5453, null, null);
